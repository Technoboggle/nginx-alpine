<!DOCTYPE HTML>
 <meta charset="utf-8" />
<html>
<head>
  <meta charset="UTF-8">
  <script src="3.5.1/jquery.min.js"></script>
  <script type="text/javascript" src="NchanSubscriber.js"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link href="all.css" rel="stylesheet">
  <link href="chat.css" rel="stylesheet">
  <script>
$( document ).ready(function() {

  var protocol = location.protocol;
  var slashes = protocol.concat("//");
  var host = slashes.concat(window.location.hostname);
  var chatStat={};
  $("#chat").click(function( event ) {
    $.ajax({
      url: host+'/pub?id=main',
      type: 'POST',
      headers: {
        Accept: "text/json; charset=utf-8",
      },
      dataType: 'json',
      data: $("#chatter").val(),
      success: function(data) {
        chatStat=data;
        $("#chatter").val("");
        /**
          The response code for an HTTP request is 202 Accepted if no subscribers are present
          at time of publication, or 201 Created if at least 1 subscriber was present.

          Metadata can be added to a message when using an HTTP POST request for publishing.
          A Content-Type header will be associated as the message's content type (and output
          to Long-Poll, Interval-Poll, and multipart/mixed subscribers). A X-EventSource-Event
          header can also be used to associate an EventSource event: line value with a message.
        */
      },
      failure: function() {
        alert('UAT repository was promoted');
      }
    });
  })

  var url = host+'/sub?id=main';
  // Edited for correct version
  var sub = new NchanSubscriber(url, {subscriber: ['longpoll', 'eventsource', 'websocket']});
  //or shorthand as
  //var sub = new NchanSubscriber(url, ['longpoll', 'eventsource', 'websocket']);
  sub.on("message", function(message, message_metadata) {
    var div = document.createElement("div");
    div.appendChild(document.createTextNode("message: " + message));
    $("#conversation").append(div);
    //$("#conversation").append(message + "<br/>");
  });



/*
  $(".person").on('click', function(){
    $(this).toggleClass('focus').siblings().removeClass('focus');
  })
*/





  sub.start();
});
</script>
</head>
<body>
  <p>Using the NchanSubscriber.js in a test scenario</p><br />
  <div id="conversation"></div>
  <div>
      <input id="chatter0" type="text"><br /><br /><br /><input id="chat0" type="button" value="Speak">
  </div>

<hr>


<!--It's just a concept, a chat UI design for direct messaging!
Enjoy! :) Don't forget to click the heart if you like it! -->

<div class="container">
  <div class="chatbox">
    <div class="top-bar">
      <div class="avatar"><p>V</p></div>
      <div class="name">Voldemort</div>
      <div class="icons">
        <i class="fas fa-phone"></i>
        <i class="fas fa-video"></i>
      </div>
      <div class="menu">
        <div class="dots"></div>
      </div>
    </div>







    <div class="middle">
      <div class="voldemort">






<!--
        <div class="incoming">
          <div class="bubble">Hey, Father's Day is coming up..</div>
          <div class="bubble">What are you getting.. Oh, oops sorry dude.</div>
        </div>
        <div class="outgoing">
          <div class="bubble lower">Nah, it's cool.</div>
          <div class="bubble">Well you should get your Dad a cologne. Here smell it. Oh wait! ...</div>
        </div>
-->






        <div class="typing">
          <div class="bubble">
            <div class="ellipsis one"></div>
            <div class="ellipsis two"></div>
            <div class="ellipsis three"></div>
          </div>
        </div>





      </div>
    </div>








    <div class="bottom-bar">
      <div class="chat">
        <input id="chatter" type="text" placeholder="Type a message..." />
        <button id="chat" type="submit"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>
  <div class="messages"></div>
  <div class="profile">
    <div class="avatar"><p>H</p></div>
    <div class="name2">Harry<p class="email">Harry@potter.com</p></div>
  </div>
  <ul class="people">
    <li class="person focus">
      <span class="title">Voldemort </span>
      <span class="time">2:50pm</span><br>
      <span class="preview">What are you getting... Oh, oops...</span>
    </li>
     <li class="person">
      <span class="title">Ron</span>
      <span class="time">2:25pm</span><br>
      <span class="preview">Meet me at Hogsmeade and bring...</span>
    </li>
    <li class="person">
      <span class="title">Hermione</span>
      <span class="time">2:12pm</span><br>
      <span class="preview">Have you and Ron done your hom...</span>
    </li>
  </ul>
</div>

<footer>
  <p>made by <a href="https://codepen.io/juliepark"> julie</a> â™¡
</footer>

<body>
</html>
